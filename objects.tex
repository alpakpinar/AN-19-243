\section{Physics objects} \label{sec:objects}

All physics objects are used to identify signal-like events, to suppress backgrounds and to define control regions
for background estimation. For the object definitions, we mostly follow the CMS POG endorsed recommendations. The physics 
objects and the selection requirements are described below.

\subsection{Jets}
\label{sec:objects_ak4}
In this analysis, jets are reconstructed by clustering PF candidates
using the infrared and collinear safe anti-\kt algorithm~\cite{Cacciari:2008gp}. Jets are clustered
with a distance parameter of 0.4 and are referred to as AK4 jets.
The reconstructed vertex with the largest value of summed physics-object $\pt^2$ is taken to
be the primary $\Pp\Pp$ interaction vertex. The physics objects are those returned by a
jet finding algorithm~\cite{Cacciari:2008gp,Cacciari:2011ma} applied to all charged PF candidates
associated with the vertex, plus the corresponding associated missing transverse momentum.

Jet momentum is determined as the vector sum of all particle momenta in the jet,
and is found from simulation to be within 5 to 10\% of the true momentum over the full \pt
spectrum and detector acceptance. An offset correction is applied to jet energies to take
into account the contribution from additional proton-proton interactions within the
same or nearby bunch crossings (pileup). Jet energy corrections are derived from simulation,
and are confirmed with {\it in situ} measurements of the energy balance in dijet, multijet,
$\gamma$+jet, and leptonic Z+jet events~\cite{Khachatryan:2016kdb}. The \texttt{Fall17\_17Nov2017\_V32} and \texttt{Autumn18\_V8}
versions of the jet energy corrections are used for the 2017 and 2018 data sets, respectively.

The AK4 jets used in this analysis are required to pass loose jet identification criteria.
In addition, all the jets with \pt smaller than $50 GeV$ must pass the medium pileup ID criteria. This additional constraint
on all AK4 jets is found to improve the modeling of jet distributions, especially in the horn regions near $|\eta| = 2.9$. 
The effect of this requirement is demonstrated in the sub-leading jet $\eta$ distribution in Fig.~\ref{fig:pileupid}.

\begin{figure}[htbp]
  \centering
        \includegraphics[width=0.45\textwidth]{fig/datamc/puid_comparison/cr_1e_vbf_ak4_eta1_losf_2017_puid.png}
        \includegraphics[width=0.45\textwidth]{fig/datamc/puid_comparison/cr_1e_vbf_ak4_eta1_losf_2017_nopuid.png}
  \caption{Subleading AK4 jet $\eta$ distribution in single electron control region with pileup ID requirement (left) 
  and without pileup ID requirement (right).}
  \label{fig:pileupid}
\end{figure}

In addition to the pileup ID requirement, JER corrections are applied to all AK4 jets. Application of this correction on all 
jets is observed to improve the modeling of the jets, especially near the horn regions near $|\eta| = 2.9$. The effect of JER 
corrections on the subleading jet eta distribution is shown in Fig.~\ref{fig:jer_correction}.

\begin{figure}[htbp]
  \centering
        \includegraphics[width=0.45\textwidth]{fig/datamc/jer_comparison/cr_1e_vbf_ak4_eta1_losf_2017_jer.png}
        \includegraphics[width=0.45\textwidth]{fig/datamc/jer_comparison/cr_1e_vbf_ak4_eta1_losf_2017_nojer.png}
  \caption{Subleading AK4 jet $\eta$ distribution in single electron control region with JER corrections applied (left) 
  and without JER corrections applied (right).}
  \label{fig:jer_correction}
\end{figure}

\subsubsection{b-tagged jets}

%{\color{red} Update the b-tagging working point when the new tagging working points are defined}
In this analysis b jets with $\pt > 20$~\GeV and $|\eta| < 2.4$ are identified
using the ``DeepCSV'' algorithm~\cite{Sirunyan:2017ezt},
adopting a working point (medium) corresponding to correctly identifying a b-jet with a
probability of 80\%, and misidentifying a light-flavor jet with a probability of 10\%.
This working point corresponds to the value of DeepCSV tagger to be greater than 0.4941.
Events with identified b jets are rejected to reduce the contamination from top quark processes.

\subsection{Missing transverse momentum and recoil}

The vector \ptvecmiss is defined as the imbalance in the transverse
momentum of all particles that interact with the detectors.
Due to momentum conservation in the plane transverse to the beam axis, \ptvecmiss
corresponds to the transverse momentum that is carried by undetected particles such as neutrinos.
Practically, \ptvecmiss is computed as the negative of the vectorial sum of transverse
momenta of all PF candidates and is therefore also referred to as PF \ptvecmiss. 
The magnitude of the \ptvecmiss is referred to as \ptmiss.

Minimum energy thresholds in the calorimeters, inefficiencies
in the tracker, nonlinearity of the response of the calorimeter
for hadronic particles can lead to an over- or underestimation of \ptmiss.
The bias on the \ptmiss measurement is reduced by propagating the effect of the jet energy
corrections introduced in section~\ref{sec:objects_ak4} according to

\begin{equation}
\ptvecmiss(\mathrm{corr})
=\ptvecmiss - \sum_\mathrm{jets} (\vec{p}_\mathrm{T,jet}({\mathrm{corr}})-\vec{p}_\mathrm{T,jet}),
\label{eq:Type1MET}
\end{equation}
where the ``corr'' refers to the scale energy corrected measurements
of the related objects.

This ``type-I'' correction for \ptvecmiss uses jet energy scale corrections
for all corrected jets with $\pt>15\GeV$ that have less than $0.9$
of their energy deposited in the ECAL. Furthermore, if a muon is found in a
jet, its 4-momentum is subtracted from the 4-momentum of the jet
when performing the correction and is added back to a corrected object.

Since signal events in this analysis contain only jets and no other reconstructed candidates,
\ptmiss is equivalent to the total hadronic momentum in the event. For the leading backgrounds, 
this also corresponds to the transverse momentum of the W or Z boson. 
To mimic this behavior in in the control regions of this analysis, the transverse
momentum of the hadronic recoil $\vec{U}$, defined as the vectorial sum of the transverse
momenta of all particles except the vector boson (or its decay products), is used.
The variable is  computed as
\begin{equation}
  \vec{U} = \ptvecmiss + \sum _{i\;\in\;\textrm{leptons, photons}}\vec{p}^{i}_{T}}
\end{equation}

where the sum takes into account the leptons and photons used to define the respective control region.
The uncertainty of \ptmiss has a strong dependence on the
event topology. Therefore, the uncertainty on \ptmiss is often factorized into its components of
jets, leptons and unclustered energy. Each sub-component is then varied
within its scale and resolution uncertainty. 

Anomalous high-\ptmiss events can appear due to various phenomena.
In the ECAL, spurious deposits may appear due to particles striking
sensors in the ECAL photodetectors, or from real showers with non-collision
origins such as those caused by beam halo particles. ECAL dead cells can cause real
energy to be missed, again leading to a spurious imbalance.
In the HCAL, spurious energy can arise due to  noise in the hybrid
photodiode and readout box  electronics, as well as
direct particle interactions with  the light guides and
photomultiplier tubes of the forward calorimeter. 
A number of filters has been developed by the POG/DPG groups to identify and supress anomalous high
\ptmiss events~\cite{CMS-JME-TWIKI-FILTER}. The recommended filters are listed in Tab.~\ref{tab:metfilters} and are applied in the analysis.

\begin{table}[ht!]
    \centering
    \small
    \def\arraystretch{1.5}
    \caption{The \ptmiss filters recommended by the JME POG~\cite{CMS-JME-TWIKI-FILTER}. The recommendations apply to both 2017 and 2018. Except for the bad super cluster filter (``ee badSC''), all filters are applied both in data and simulation.}
    \begin{tabular}{l l c }
        \hline
        \hline
                                           &                                                                     \\
        Filter                             & Name in NanoAOD                          & Applied in data (MC)     \\\hline
        primary vertex filter              & Flag\_goodVertices                       & \checkmark  (\checkmark) \\
        beam halo filter                   & Flag\_globalSuperTightHalo2016Filter     & \checkmark  (\checkmark) \\
        HBHE noise filter                  & Flag\_HBHENoiseFilter                    & \checkmark  (\checkmark) \\
        HBHEiso noise filter               & Flag\_HBHENoiseIsoFilter                 & \checkmark  (\checkmark) \\
        ECAL TP filter                     & Flag\_EcalDeadCellTriggerPrimitiveFilter & \checkmark  (\checkmark) \\
        Bad PF Muon Filter                 & Flag\_BadPFMuonFilter                    & \checkmark  (\checkmark) \\
        ee badSC noise filter              & Flag\_eeBadScFilter                      & \checkmark  (\times)     \\
        ECAL bad calibration filter update & Flag\_ecalBadCalibFilterV2               & \checkmark  (\checkmark) \\
        \hline
    \end{tabular}

    \label{tab:metfilters}
\end{table}

\subsection{Leptons}

\subsubsection{Electrons}

Electrons within the geometrical acceptance of $|\eta| < 2.5$
are reconstructed by associating tracks reconstructed
in the silicon detector with clusters of energy in the ECAL~\cite{Khachatryan:2015hwa}.
Well-identified electron candidates are required to satisfy
additional identification criteria based on the shower
shape of the energy deposit in the ECAL and the consistency of the
electron track with the primary vertex~\cite{TRK-11-001}. Electron candidates
that are identified as coming from photon conversions in
the detector material are removed. An isolation variable is calculated based on the sum of the energies of the PF candidates 
within a cone of $\Delta R < 0.3$ around the electron. The mean energy deposit in the isolation cone of the electron coming 
from pileup is estimated following the method described in Ref.~\cite{Khachatryan:2015hwa} and subtracted from the isolation sum. 
In this note, `veto'~\cite{CMS-EGM-TWIKI-ELEID} electrons with a minimum $\pt$ of 10~\GeV are selected with an average efficiency 
of 95\% and their presence is used as a condition to reject events, whereas `tight'~\cite{CMS-EGM-TWIKI-ELEID} electrons with a 
minimum $\pt$ of 40~\GeV and an average efficiency of 70\% are used to select the events
in the control regions. Full selection criteria are shown in Table~\ref{tab:ElectronIDTight}.

\begin{table}[htb]
    \centering
    \small
    \def\arraystretch{1.5}
    \caption{Tight and veto electron identification criteria.}

    \begin{tabular}{ l c c}
        \hline\hline
        Variable                                                & Selection Tight                              & Selection Veto                             \\
                                                                & Barrel (Endcaps)                             & Barrel (Endcap)                            \\
        \hline
        \hline
        \multirow{2}{*}{Full 5x5 $\sigma_{i\eta i\eta}$}        & $< 0.0104  $                                 & $< 0.0126   $                              \\
                                                                & ($< 0.0353   $)                              & ($< 0.0457   $)                            \\\cline{2-3}
        \multirow{2}{*}{$|\Delta \eta_{in}|$}                   & $< 0.00255  $                                & $< 0.00463  $                              \\
                                                                & ($< 0.00501  $)                              & ($< 0.00814   $)                           \\\cline{2-3}
        \multirow{2}{*}{$|\Delta \phi_{in}|$}                   & $< 0.022   $                                 & $< 0.148    $                              \\
                                                                & ($< 0.0236   $)                              & ($< 0.19    $)                             \\\cline{2-3}
        \multirow{2}{*}{H/E}                                    & $< 0.026+1.15/E_{SC}+0.0324\rho/E_{SC}  $    & $< 0.05+1.16/E_{SC}+0.0324\rho/E_{SC}   $  \\
                                                                & ($< 0.0188+2.06/E_{SC}+0.183*\rho/E_{SC}  $) & ($< 0.05+2.54/E_{SC}+0.183\rho/E_{SC}   $) \\\cline{2-3}
        \multirow{2}{*}{Relative isolation ($\rho$ correction)} & $< 0.0287+0.506/pT  $                        & $< 0.198+0.506/\pt   $                     \\
                                                                & ($< 0.0445+0.963/\pt  $)                     & ($< 0.203+0.963/\pt   $)                   \\\cline{2-3}
        \multirow{2}{*}{1/E - 1/p}                              & $< 0.159   $                                 & $< 0.209    $                              \\
                                                                & ($< 0.0197   $)                              & ($< 0.132    $)                            \\\cline{2-3}
        \multirow{2}{*}{$|\mathrm{d_{xy}(vtx)}|$}               & $< 0.050   $                                 & $< 0.050 $                                 \\
                                                                & ($< 0.100   $)                               & ($< 0.100   $)                             \\\cline{2-3}
        \multirow{2}{*}{$|\mathrm{d_{z}(vtx)}|$}                & $< 0.100   $              & $< 0.100 $            \\
                                                                & ($< 0.200   $)                               & ($< 0.200   $)                             \\\cline{2-3}
        \multirow{2}{*}{Expected Inner Missing Hits}            & $<= 1$                                       & $<= 2 $                                    \\
                                                                & ($<= 1$)                                     & ($<= 3$)                                   \\\cline{2-3}
        \multirow{2}{*}{Pass conversion veto}                   & Yes                                          & Yes                                        \\
                                                                & (Yes)                                        & (Yes)                                      \\
        \hline\hline
    \end{tabular}
    \label{tab:ElectronIDTight}
\end{table}



\subsubsection{Muons}

Muons within the geometrical acceptance of $|\eta| < 2.4$ are reconstructed by combining information from the silicon tracker 
and the muon system~\cite{Chatrchyan:2012xi}. The muons are required to pass set of quality criteria based on the number of spatial 
points measured in the tracker and in the muon system, the fit quality of the muon track and its consistency with the primary vertex 
of the event. Similar to electron case, the isolation requirements for muons are also based on the sum of the energies of the PF candidates, 
but a different cone size of a $\Delta R < 0.4$ is used. The muon isolation variable is corrected for pileup effects by subtracting half 
of the sum of the transverse momenta of charged particles that are inside the isolation cone and not associated with the primary vertex. 
In this note, ``loose''~\cite{CMS-MUO-TWIKI-IDLOOSE} muons with $\pt>10~\GeV$ are selected with an average efficiency of 98\% and 
are used as a condition to reject events,whereas ``tight''~\cite{CMS-MUO-TWIKI-IDTIGHT} muons with $\pt>20~\GeV$ are selected with an 
average efficiency of 95\% and are used to select events in the control samples. 
A full list of tight identification criteria is given here:

\begin{itemize}
\item Muon reconstructed as a global muon
\item Muon reconstructed as a particle flow muon
\item Normalized $\chi^2$ of the global track less than 10
\item At least one muon chamber hit included in the global track fit
\item Muon segments in at least two muon stations
\item Transverse impact parameter w.r.t. the primary vertex less than $2$ mm.
\item Longitudinal impact parameter w.r.t. the primary vertex less than $5$ mm.
\item At least one pixel hit
\item Hits on at least 5 tracker layers
\item $\Delta\beta$ relative isolation less than 0.15
\end{itemize}

\subsubsection{Taus}

Hadronically decaying $\tau$ leptons are required to pass identification criteria
using the hadron-plus-strips algorithm~\cite{Khachatryan:2015dfa}. The algorithm
identifies a jet as an hadronically decaying tau lepton candidate if a subset of the
particles assigned to the jet is consistent with the decay products of a $\tau$ candidate.
Candidate $\tau$ jets are reuired to pass both the ``DecayModeNewDMs'' and ``DecayMode'' identifiers.

In addition, $\tau$ candidates are required to be isolated from other activity in the
event. The isolation requirement is computed by summing the \pt of the charged PF
candidates and PF photon candidates within an isolation cone of $\Delta R = 0.5 (0.3)$,
around the tau candidate direction. The charged and photon candidates associated with the
tau candidate are removed from this sum and further described in Ref.~\cite{Khachatryan:2015dfa}.
The ``VLoose\_IsolationMVArun2v1DBoldDMwLT'' isolation working point~\cite{taupog_twiki} is employed in this analysis
for tau candidates with \pt larger than 20~\GeV within $|\eta| < 2.3$.


\subsection{Photons}

Photon candidates are reconstructed from energy deposits in the ECAL using algorithms
that constrain the clusters to the size and shape expected from a photon~\cite{CMS:EGM-14-001}.
The identification of the candidates is based on shower-shape and isolation variables.
For isolated photons, scalar sums of the \pt of PF candidates within a cone of $\Delta R < 0.3$
around the photon candidate are required to be below the bounds defined. Only the PF candidates
that do not overlap with the EM shower of the candidate photon are included in the isolation sums.

Two candidate definitions are employed. ``Loose'' photons are used to reject events with unwanted
photons. These photons are required to pass the EGamma POG `loose' identification criteria~\cite{CMS-EGM-TWIKI-GAMID},
have a transverse momentum of at least 15\GeV and be within $|\eta|<2.5$. The exact identification criteria are summarized in Table~\ref{tab:PhotonIDLoose}.
A ``tight'' photon definition is used for the photon in the dedicated photon control region. These photons are required to be in the barrel ($|\eta|<1.479$), and have $\pt>215\GeV$. The POG medium ID is employed, which is summarized in Table~\ref{tab:PhotonIDTight}.

\begin{table}[htb!]
\centering
\small
\def\arraystretch{1.2}
\begin{tabular}{l c}
\hline
Variable                                   &  Selection       \\
                                           &  Barrel (Endcap)  \\
\hline
\hline
Full 5x5 $\sigma_{i\eta i\eta}$            & $< 0.0106 $ ($< 0.0272 $)    \\
H/E                                        & $<  0.04596 $ ($< 0.0590 $)    \\
charged hadron isolation                   & $< 1.694 $  ($< 2.089 $)     \\
neutral hadron isolation                   & $< 24.032 (19.722) + 0.01512(0.0117)\times p_T+2.259(2.3)\times 10^{-5} \times {p_T}^2$ \\
photon isolation                           & $< 2.876 (4.162) + 0.004017(0.0037)\times p_T$  \\
Conversion safe electron veto              & Yes (Yes)           \\
\hline
\end{tabular}
\caption{Loose photon identification criteria.}
\label{tab:PhotonIDLoose}
\end{table}

\begin{table}[htb!]
\centering
\small
\def\arraystretch{1.2}
\begin{tabular}{l c}
\hline
Variable                                   &  Selection       \\
                                           &  Barrel  \\
\hline
\hline
Full 5x5 $\sigma_{i\eta i\eta}$            & $<  0.01015  $ \\
H/E                                        & $<  0.02197  $   \\
charged hadron isolation                   & $< 1.141  $     \\
neutral hadron isolation                   & $< 1.189  + 0.01512\times p_T+2.259\times 10^{-5} \times {p_T}^2$ \\
photon isolation                           & $< 2.08 + 0.004017\times p_T$  \\
Conversion safe electron veto              & Yes           \\
\hline
\end{tabular}
\caption{Tight photon identification criteria. The criteria are only given for the barrel region since endcap photons are not taken into account.}
\label{tab:PhotonIDTight}
\end{table}

\subsubsection{Photon purity}
Photons are reconstructed from ECAL clusters, and can discriminated from other sources of ECAL deposits due to the properties of the cluster, as well as their lack of other associated signatures such as tracks or HCAL deposits. This discrimination is not perfect, however, and in some cases, non-photon objects will incorrectly be identified as photons (``fakes''). The leading source of fake photons is QCD production of multijet events, where a jet is misidentified. This process is relevant mainly because of its large cross-section, which yields non-negligible contributions to the photon selection even if the per-jet probability of misreconstruction is small.

To estimate the fake contribution to the photon control region, a purity measurement is performed. The photon purity is defined as the fraction of reconstructed photons that is actually due to an isolated photon from the hard scattering event, as opposed to a fake. The purity is obtained from a template fit to the distribution of the \sieie variable in data, which \sieie variable represents the width of the ECAL shower in the $\eta$ direction. Due to the different shower behavior of photons and hadrons, the \sieie distribution shows characteristically different behavior between these two classes of reconstructed photons: Real photons show a large peak with a cut-off around $\sieie\approx0.01$, while fake photons will have a smaller peak (stemming from actual photons inside jets), and an additional non-peaking bulk region at larger \sieie (stemming from hadrons interacting in the ECAL). The inputs to the fit are defined as follows:

\begin{itemize}
\item Photons in data are selected by applying the same identification criteria as for the tight selection defined above, with the exception of the \sieie requirement. By removing this requirement, the full \sieie distribution can be observed.
\item A real photon template is obtained from \textsc{GJets} simulation. The same identification criteria are applied as in data.
\item A fake photon template is obtained from data. In this case, the identification criteria are modified by requiring that at least one of the isolation criteria is not passed. Therefore, the photons in this template do not overlap with the the `data' template, and represent reconstructed photons inside jets.
\end{itemize}

The templates are derived in separate bins of the photon $\pt$ and the measurement is performed separately for 2017 and 2018. Events are selected using the following criteria:

\begin{itemize}
    \item At least one jet with $\pt>100\Gev$ and $|\eta|<2.4$, which is not overlapping with a photon of interest.
    \item The event must pass the \texttt{HLT\_Photon200} trigger, as well as the MET filters.
    \item The event must have $\ptmiss<60\GeV$.
\end{itemize}

The fits are shown in Figs.~\ref{fig:purity_fits_2017} and~\ref{fig:purity_fits_2018}, and the resulting purity as a function of photon \pt is shown in Fig.~\ref{fig:purity_result}. While the fits are performed in the full range of $\sieie<0.15$, the purity is evaluated only taking into account the contributions with $\sieie<0.01015$, which is the requirement posed in the identification criteria used in the analysis. The resulting purity ranges between $2$ and $4\%$, with a decreasing trend with photon \pt.


\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt200-250.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt250-300.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt300-400.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt400-500.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt500-600.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2017_pt600-1000.pdf}
    \caption{Template fits used to determine the photon purity in the 2017 dataset. The fits are shown in bins of photon \pt, increasing from left to right and top to bottom. }
    \label{fig:purity_fits_2017}
  \end{figure}
\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt200-250.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt250-300.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt300-400.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt400-500.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt500-600.pdf}
    \includegraphics[width=0.45\textwidth]{fig/purity/fit_2018_pt600-1000.pdf}
    \caption{Template fits used to determine the photon purity in the 2018 dataset. The fits are shown in bins of photon \pt, increasing from left to right and top to bottom. }
    \label{fig:purity_fits_2018}
  \end{figure}

\begin{figure}[htbp]
    \centering
    \includegraphics[width=0.6\textwidth]{fig/purity/purity.pdf}
    \caption{Photon purity as a function of photon \pt. This figure shows the aggregated results obtained from the fits shown in Figs.~\ref{fig:purity_fits_2017} and~\ref{fig:purity_fits_2018}.}
    \label{fig:purity_result}
  \end{figure}
